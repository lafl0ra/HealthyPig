{% extends 'base.html' %}

{% load static %}

{% block title %}
Food Detail
{% endblock %}

{% block content %}

<div style="margin-top: 8%;" class="container">
    <div class="row">
        <div class="col-sm">
            <h1 style="margin-top: 2%; font-size: 64px;color: darkblue;">{{ food.name }}</h1>
            <form style="margin-top: 2%;" method="POST"> {% comment %} ส่งฟอร์มไปยังเซิร์ฟเวอร์ด้วย POST {% endcomment %}
                {% csrf_token %}
                <div style="width: 50%;">
                    {% if food.description %}
                    <p> <b> Description : </b> {{ food.description }} </p> 
                    {% endif %}
                    {% if food.quantity_in_grams %}
                    <p> <b> Quantity in grams : </b> {{ food.quantity_in_grams }} grams . </p>
                    {% endif %}
                    {% if food.ingredients.all %}
                    <h3>Ingredients:</h3>
                    <ul> 
                        {% for ingredient in food.ingredients.all %}
                        <li>{{ ingredient.name }}</li>
                        {% endfor %}
                    </ul>
                    {% endif %}
                    <table>
                        <tr>
                            <td>
                                <tr>
                                <b>Serve Amount:</b>
                                {{ form.amount }}
                                <tr>
                            </td>
                        </tr>
                        <tr>
                            <button type="button" class="btn btn-primary" style="margin-bottom: 10px; margin-top: 15%;" onclick="calculate()">calculate </button>
                            <input style="width: 50%; margin-top: 2%;" id="resultInput" class="form-control bg-white border-info text-info" value="{{ food.calories }} kcal" readonly>
                        </tr>
                    </table>
                </div>                
                <button type="submit" class="btn btn-success w-20 mt-5">Save</button>
            </form>
        </div>
        <div class="col-sm">
            {% comment %} แสดงรูปภาพแบบสุ่ม {% endcomment %}
            <div style="margin-top: 5%;">
                <img style="width: 600px;" id="randomImage" alt="Random Image">
            </div>
        </div>
    </div>
</div>
<script>
    // สร้างลิสต์ของรูปภาพ
    const images = [
        '{% static "fooddetailrandom (1).jpg" %}',
        '{% static "fooddetailrandom (2).jpg" %}',
        '{% static "fooddetailrandom (3).jpg" %}',
        '{% static "fooddetailrandom (4).jpg" %}',
        '{% static "fooddetailrandom (5).jpg" %}'
    ];

    // ฟังก์ชันเพื่อสุ่มเลือกรูปภาพ
    function getRandomImage() {
        const randomIndex = Math.floor(Math.random() * images.length);
        return images[randomIndex];
    }

    // แสดงรูปภาพแบบสุ่มเมื่อโหลดหน้า
    document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('randomImage').src = getRandomImage();
    });

    // ฟังก์ชันสำหรับคำนวณแคลอรี่
    function calculate() {
        // ดึงค่าจาก form.amount
        const amount = parseFloat(document.querySelector('[name="amount"]').value); // เปลี่ยน 'amount' เป็นชื่อฟิลด์จริงๆ ของคุณ
        // คำนวณค่า (ในที่นี้คุณสามารถปรับให้เป็นการคำนวณที่คุณต้องการ)
        const cal = parseFloat({{ food.calories }}); // Ensure food.calories is treated as a float
        const result = (amount * cal).toFixed(2) + " kcal"; // ตัวอย่างการคำนวณและจัดรูปแบบเป็น 2 ตำแหน่งทศนิยม
        
        // แสดงผลใน input
        document.getElementById('resultInput').value = result;
    }
</script>
{% endblock %}
